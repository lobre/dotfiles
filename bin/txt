#!/bin/sh
#
# Copy text as an image to clipboard

usage() {
    echo "usage: txt [-b] [-s size] [-c color] [text... | -]" >&2
    exit 1
}

size=18
color=black
weight="Regular"
stdin="false"

while [ $# -gt 0 ]; do
    case "$1" in
        -)  stdin="true";      shift ;;
        -b) weight="Bold";     shift ;;
        -s) shift; size="$1";  shift ;;
        -c) shift; color="$1"; shift ;;
        --) shift; break ;;
        -*) usage ;;
        *)  break ;;
    esac
done

font="PragmataPro-Liga-$weight"

# text from parameters or stdin
text="$*"; [ "$stdin" = "true" ] && text="$(cat)"

# preserve spaces by replacing them with nbsp
text=$(printf '%s' "$text" | sed "s/ /$(printf '\302\240')/g")

dpi=$(
    xrdb -query 2>/dev/null | awk '
        BEGIN { d = 72 }
        $1 == "Xft.dpi:" { d = $2 }
        END { print d }
    '
)

convert \
    +antialias \
    -density "$dpi" \
    -background none \
    -fill "$color" \
    -font "$font" \
    -pointsize "$size" \
    label:"$text" \
    png:- \
| xclip -selection clipboard -t image/png
