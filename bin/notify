#!/bin/sh

msg="Lost words leave empty spaces."
timeout=0
detach=0

while [ $# -gt 0 ]; do
    case "$1" in
        -t) timeout=$2; shift 2 ;;
        -d) detach=1; shift ;;
        -)  msg=$(cat); shift ;;
        *)  msg="$*"; break ;;
    esac
done

[ -z "$msg" ] && exit 0

# kill existing notification
pkill -f 'xterm .* -name xnotify'

# calculate number of lines and columns needed
height=$((2 + $(printf '%s\n' "$msg" | wc -l)))
width=$(printf '%s\n' "$msg" | awk '{ print length }' | sort -nr | head -n1)
width=$(( width < 40 ? 40 : width ))

xterm -geometry "${width}x${height}-30+30" -name xnotify -T "notification" \
    -xrm 'XTerm*internalBorder: 20' \
    -e sh -c '
        # hide cursor
        printf "\033[?25l"
        trap "printf \"\033[?25h\"" EXIT

        dismiss() {
            label="[ Dismiss ]"
            cols=$(tput cols)
            pad=$(( (cols - ${#label}) / 2 ))
            printf "%${pad}s%s" "" "$label"
        }

        printf "%s\n\n" "$1"
        dismiss

        if [ "$2" -eq 0 ]; then
            IFS= read -r dummy
        else
            sleep "$2"
        fi
    ' _ "$msg" "$timeout" &

# wait if not detached
[ "$detach" -eq 0 ] && wait "$!"
