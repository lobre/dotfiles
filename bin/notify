#!/bin/sh

msg="Lost words leave empty spaces."
timeout=0
detach=0

while [ $# -gt 0 ]; do
    case "$1" in
        -t) timeout=$2; shift 2 ;;
        -d) detach=1; shift ;;
        -)  msg=$(cat); shift ;;
        *)  msg="$*"; break ;;
    esac
done

# kill existing notification
pkill -f 'xterm .* -name xnotify'

xterm -geometry 50x3-30+30 -name xnotify -T "notification" \
    -xrm 'XTerm*internalBorder: 20' \
    -e sh -c '
        # hide cursor
        printf "\033[?25l"
        trap "printf \"\033[?25h\"" EXIT

        dismiss() {
            label="[ Dismiss ]"
            cols=$(tput cols)
            pad=$(( (cols - ${#label}) / 2 ))
            printf "%${pad}s%s" "" "$label"
        }

        printf "%s\n\n" "$1"
        dismiss

        if [ "$2" -eq 0 ]; then
            IFS= read -r dummy
        else
            sleep "$2"
        fi
    ' _ "$msg" "$timeout" &

# wait if not detached
[ "$detach" -eq 0 ] && wait "$!"
